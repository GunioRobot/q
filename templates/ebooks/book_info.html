{% extends 'ebooks/_base.html' %}
{% load gravatar %}

{% block extra_javascript %}
	<script src="/javascript/librarian.js"></script>
{% endblock %}

{% block body_class %} class="page-view"{% endblock %}
{% block content %}
	{% if book %}
		<div class="book-sidebar">
			<figure class="cover">
				{% if book.cover %}
					<img src="{{ book.cover.url }}" width="160" />
				{% else %}
					<img src="/images/book-no-cover.png" width="160" />
				{% endif %}
				<div class="overlay"></div>
			</figure>
			<h2 class="section-title">Formats</h2>
			<ul class="formats">
				{% for format in book.formats %}
					<li class="{{ format.format }}"><a href="{{ format.ebook_file.url }}">{{ format.format }}</a></li>
                    {% if format.format == 'mobi' and request.user.get_profile.kindle_email %}
                    <li><a href="{% url email_kindle book.id %}">email to kindle</a></li>
                    {% endif %}
				{% endfor %}
			</ul>

			{% if book.is_physical %}

				{% if my_ownership %}
                    <h2 class="section-title">My QR Code</h2>
                    <p>
                        <div class="qr-code"><a href="{% url book_checkout my_ownership.key %}"><img src="{{ my_ownership.qr_url }}" /></a></div>
                    </p>
				{% endif %}

                {% with book.owners as owners %}
                {% if owners %}
                    <h2 class="section-title">Owners</h2>
                        <ul style="list-style-type: none; margin: 0 0 15px 0;">
                            {% for owner in owners %}
                                <li style="overflow: hidden; border-bottom: 1px dotted #dedede; padding: 5px 0; margin: 0 ">
                                 <div style="border: 1px solid #dedede; height: 35px; width: 35px; float: left; margin-left: 15px">
                                    <a href="{% url view_user owner.user.username  %}" style="border: none">
                                        {% gravatar owner.user 35 %}
                                    </a>
                                 </div>
                                 <div style=" float: left; margin-left: 10px">
                                     {% if owner.checked_out %}
                                     <a href="{% url view_user owner.checked_out.user.username  %}">{{ owner.checked_out.user.username }}</a> has<br/>{{ owner.user.username }}'s copy.
                                     {% else %}
                                     Ask <a href="{% url view_user owner.user.username  %}"> {{ owner.user.username }}</a><br /> to borrow it.
                                     {% endif %}
                                 </div>
                                </li>
                            {% endfor %}
                        </ul>
                {% endif %}
                {% endwith %}
			{% endif %}
		</div>

		<div class="book-main">
			<p class="series-info"><a href="">Series Title:</a> Book 3</p>
			<hr />

	        <h1 class="editable" id="title_{{ book.id }}">{{ book.title }}</h1>
			<ul class="byline">
				<li class="title">written by:</li>
            {% for author in book.authors.all %}
                <li>{{ author }}</li>
            {% endfor %}
			</ul>

			<h2 class="sub-title">Description:</h2>
			<p class="editable" id="description_{{ book.id }}">{{ book.description|safe }}</p>


			<h2 class="sub-title">What people are saying:</h2>

			<h2 class="sub-title">Related Books:</h2>

			<h2 class="sub-title">Tags:</h2>
		</div>
	{% endif %}
{% endblock %}

{% block rail %}
    {% if book.is_physical %}
	<h2 class="section-title">Check Out History</h2>
	<ul>
	{% for checkout in checkouts %}
	    <li style="overflow: hidden; border-bottom: 1px dotted #dedede; padding: 5px 0; margin: 0 ">
    	    <div style="border: 1px solid #dedede; height: 35px; width: 35px; float: left; margin-left: 15px">
    	       <a href="{% url view_user checkout.user.username %}" style="border: none">
                   {% gravatar checkout.user 35 %}
    	       </a>
    	    </div>
    	    <div style=" float: left; margin-left: 10px">
    	        <a href="{% url view_user checkout.user.username  %}">
    	            {{ checkout.user.username }}
    	        </a>
    	        checked it out<br /> on <em>{{ checkout.create_time|date:"F j, Y" }}.</em>
    	    </div>
	    </li>
	{% endfor %}
    </ul>
    {% endif %}
{% endblock %}
